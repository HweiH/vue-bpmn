{"version":3,"sources":["webpack:///./src/views/New.vue?6da1","webpack:///./src/views/New.vue?5255","webpack:///src/views/New.vue","webpack:///./src/views/New.vue?7641","webpack:///./src/views/New.vue?cbbf"],"names":["render","_vm","this","_h","$createElement","_c","_self","ref","staticClass","attrs","_v","changeFile","slot","staticRenderFns","component"],"mappings":"kHAAA,yBAAilB,EAAG,G,oECAplB,IAAIA,EAAS,WAAa,IAAIC,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAOE,EAAG,MAAM,CAACE,IAAI,aAAaC,YAAY,cAAc,CAACH,EAAG,MAAM,CAACE,IAAI,SAASC,YAAY,SAASC,MAAM,CAAC,GAAK,eAAeJ,EAAG,KAAK,CAACG,YAAY,WAAW,CAACH,EAAG,KAAK,CAACA,EAAG,IAAI,CAACE,IAAI,cAAcE,MAAM,CAAC,KAAO,cAAc,MAAQ,0BAA0B,CAACR,EAAIS,GAAG,uBAAuBL,EAAG,KAAK,CAACA,EAAG,IAAI,CAACE,IAAI,UAAUE,MAAM,CAAC,KAAO,cAAc,MAAQ,0BAA0B,CAACR,EAAIS,GAAG,oBAAoBL,EAAG,YAAY,CAACG,YAAY,SAASC,MAAM,CAAC,kBAAiB,EAAM,OAAS,GAAG,eAAc,EAAM,YAAYR,EAAIU,aAAa,CAACN,EAAG,KAAK,CAACA,EAAG,IAAI,CAACE,IAAI,SAASE,MAAM,CAAC,KAAO,UAAU,KAAO,cAAc,MAAQ,uBAAuBG,KAAK,WAAW,CAACX,EAAIS,GAAG,0BAA0B,MAChxBG,EAAkB,G,wBCwBtB,GACE,KADF,WAEI,MAAJ,CACM,YAAN,KACM,WAAN,KACM,OAAN,KACM,OAAN,KACM,sBAAN,CACQ,UAAR,oBAIE,QAAF,CACI,YADJ,SACA,GACM,KAAN,qCACA,GAIU,QAAV,aASI,iBAhBJ,WAgBM,IAAN,OACA,wFAEM,KAAN,aAEA,kBAEQ,EAAR,uBAEA,mBACQ,QAAR,WAII,QA9BJ,SA8BA,GAEM,KAAN,wBAGI,YAnCJ,SAmCA,GAEM,KAAN,qBAAQ,QAAR,kBACQ,EAAR,SAII,WA1CJ,SA0CA,OAEM,IAAN,wBAEM,KAAN,SAEA,IACQ,EAAR,mBACQ,EAAR,oDACQ,EAAR,aAII,WAvDJ,SAuDA,GACM,IAAN,OACA,iBACA,QACM,EAAN,sBACM,EAAN,mBACQ,IAAR,kBACQ,EAAR,qCACA,GACY,QAAZ,eAME,QAlFF,WAoFI,KAAJ,iCAGI,IAAJ,oBACI,KAAJ,wBACM,UAAN,EACM,kBAAN,CACA,oCAKI,IAAJ,OAEA,yBACA,qBAEI,KAAJ,kDACM,EAAN,uBACQ,EAAR,wCAGM,EAAN,2BACQ,EAAR,4CAII,KAAJ,qBCxI6U,I,wBCQzUC,EAAY,eACd,EACAd,EACAa,GACA,EACA,KACA,KACA,MAIa,aAAAC,E","file":"js/chunk-19d08552.b534ddf5.js","sourcesContent":["import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/style-resources-loader/lib/index.js??ref--8-oneOf-1-4!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./New.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/style-resources-loader/lib/index.js??ref--8-oneOf-1-4!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./New.vue?vue&type=style&index=0&lang=scss&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{ref:\"containers\",staticClass:\"containers\"},[_c('div',{ref:\"canvas\",staticClass:\"canvas\",attrs:{\"id\":\"js-canvas\"}}),_c('ul',{staticClass:\"buttons\"},[_c('li',[_c('a',{ref:\"saveDiagram\",attrs:{\"href\":\"javascript:\",\"title\":\"download BPMN diagram\"}},[_vm._v(\"下载 BPMN diagram\")])]),_c('li',[_c('a',{ref:\"saveSvg\",attrs:{\"href\":\"javascript:\",\"title\":\"download as SVG image\"}},[_vm._v(\"下载 SVG image\")])]),_c('el-upload',{staticClass:\"import\",attrs:{\"show-file-list\":false,\"action\":\"\",\"auto-upload\":false,\"on-change\":_vm.changeFile}},[_c('li',[_c('a',{ref:\"import\",attrs:{\"slot\":\"trigger\",\"href\":\"javascript:\",\"title\":\"import BPMN diagram\"},slot:\"trigger\"},[_vm._v(\"导入 BPMN diagram\")])])])],1)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"containers\" ref=\"containers\">\n    <div id=\"js-canvas\" class=\"canvas\" ref=\"canvas\"></div>\n    <ul class=\"buttons\">\n      <li>\n        <a ref=\"saveDiagram\" href=\"javascript:\" title=\"download BPMN diagram\">下载 BPMN diagram</a>\n      </li>\n      <li>\n        <a ref=\"saveSvg\" href=\"javascript:\" title=\"download as SVG image\">下载 SVG image</a>\n      </li>\n      <el-upload :show-file-list=\"false\" action=\"\" :auto-upload=\"false\" :on-change=\"changeFile\" class=\"import\">\n        <li>\n          <a slot=\"trigger\" ref=\"import\" href=\"javascript:\" title=\"import BPMN diagram\">导入 BPMN diagram</a>\n        </li>\n      </el-upload>\n    </ul>\n  </div>\n</template>\n\n<script>\n  // 引入Modeler\n  import BpmnModeler from 'bpmn-js/lib/Modeler'\n  // 用来进行国际化，参考官方的例子 bpmn-js-examples-master ===> i18n\n  import customTranslate from '../i18n/translate';\n\n  export default {\n    data () {\n      return {\n        bpmnModeler: null,\n        containers: null,\n        canvas: null,\n        xmlStr: null,\n        customTranslateModule: {\n          translate: [ 'value', customTranslate ]\n        }\n      }\n    },\n    methods:{\n      openDiagram(xml){\n        this.bpmnModeler.importXML(xml, function(err) {\n          if (err) {\n            // container\n            //     .removeClass('with-diagram')\n            //     .addClass('with-error');\n            console.error(err);\n          } else {\n            // container\n            //   .removeClass('with-error')\n            //   .addClass('with-diagram');\n          }\n        });\n      },\n      // 注意：必须先加载一个bpmn文件，新建就是加载一个空的bpmn文件，否则不能拖拽节点\n      createNewDiagram(){\n        var diagramUrl = 'https://cdn.staticaly.com/gh/bpmn-io/bpmn-js-examples/dfceecba/starter/diagram.bpmn';\n        // var diagramUrl = 'http://localhost:8080/newDiagram.bpmn';\n        this.$http.get(diagramUrl)\n                // 这里必须使用箭头函数，否则提示找不到openDiagram方法\n                .then((res)=>{\n                  //console.log(res.data)\n                  this.openDiagram(res.data)\n                })\n                .catch((err)=>{\n                    console.log(err)\n                })\n      },\n      // 下载为SVG格式,done是个函数，调用的时候传入的\n      saveSVG (done) {\n        // 把传入的done再传给bpmn原型的saveSVG函数调用\n        this.bpmnModeler.saveSVG(done)\n      },\n      // 下载为SVG格式,done是个函数，调用的时候传入的\n      saveDiagram (done) {\n        // 把传入的done再传给bpmn原型的saveXML函数调用\n        this.bpmnModeler.saveXML({ format: true }, function (err, xml) {\n          done(err, xml)\n        })\n      },\n      // 当图发生改变的时候会调用这个函数，这个data就是图的xml\n      setEncoded (link, name, data) {\n        // 把xml转换为URI，下载要用到的\n        const encodedData = encodeURIComponent(data)\n        // 获取到图的xml，保存就是把这个xml提交给后台\n        this.xmlStr = data\n        // 下载图的具体操作,改变a的属性，className令a标签可点击，href令能下载，download是下载的文件的名字\n        if (data) {\n          link.className = 'active'\n          link.href = 'data:application/bpmn20-xml;charset=UTF-8,' + encodedData\n          link.download = name\n        }\n      },\n      // 导入文件\n      changeFile(file){\n        let _this = this\n        let reads = new FileReader()\n        let f = file.raw\n        reads.readAsText(f, 'utf-8')\n        reads.onload = function (e) {\n          let newXml = e.target.result\n          _this.bpmnModeler.importXML(newXml, function (err) {\n            if (err) {\n              console.error(err)\n            }\n          })\n        }\n      }\n    },\n    mounted() {\n      // 获取到属性ref为“containers”的dom节点\n      this.containers = this.$refs.containers\n      //console.log(this.customTranslate)\n      // 获取到属性ref为“canvas”的dom节点\n      const canvas = this.$refs.canvas\n      this.bpmnModeler = new BpmnModeler({\n        container: canvas,\n        additionalModules: [\n          this.$data.customTranslateModule\n        ]\n      })\n\n      // 下载画图\n      let _this = this\n      // 获取a标签dom节点\n      const downloadLink = this.$refs.saveDiagram\n      const downloadSvgLink = this.$refs.saveSvg\n      // 给图绑定事件，当图有发生改变就会触发这个事件\n      this.bpmnModeler.on('commandStack.changed', function () {\n        _this.saveSVG(function (err, svg) {\n          _this.setEncoded(downloadSvgLink, 'diagram.svg', err ? null : svg)\n        })\n\n        _this.saveDiagram(function (err, xml) {\n          _this.setEncoded(downloadLink, 'diagram.bpmn', err ? null : xml)\n        })\n      })\n\n      this.createNewDiagram()\n    }\n  }\n</script>\n<style lang=\"scss\">\n  /*左边工具栏以及编辑节点的样式*/\n  @import '~bpmn-js/dist/assets/diagram-js.css';\n  @import '~bpmn-js/dist/assets/bpmn-font/css/bpmn.css';\n  @import '~bpmn-js/dist/assets/bpmn-font/css/bpmn-codes.css';\n  @import '~bpmn-js/dist/assets/bpmn-font/css/bpmn-embedded.css';\n\n  .containers {\n    position: absolute;\n    background-color: #ffffff;\n    width: 100%;\n    height: 110%;\n\n    .canvas {\n      width: 100%;\n      height: 100%;\n    }\n\n    .buttons{\n      position: absolute;\n      left: 20px;\n      bottom: 20px;\n      &>li{\n        display:inline-block;margin: 5px;\n        &>a{\n          color: #999;\n          background: #eee;\n          cursor: not-allowed;\n          padding: 8px;\n          border: 1px solid #ccc;\n          &.active{\n            color: #333;\n            background: #fff;\n            cursor: pointer;\n          }\n        }\n      }\n    }\n\n  .import{\n    display: inline-block;\n    margin:5px;\n    li{\n      list-style: none;\n      a{\n        color: #333;\n        padding: 8px;\n        border: 1px solid #ccc;\n      }\n    }\n  }\n\n    .bjs-powered-by {\n      display: none;\n    }\n  }\n</style>","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./New.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./New.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./New.vue?vue&type=template&id=3166ea38&\"\nimport script from \"./New.vue?vue&type=script&lang=js&\"\nexport * from \"./New.vue?vue&type=script&lang=js&\"\nimport style0 from \"./New.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}